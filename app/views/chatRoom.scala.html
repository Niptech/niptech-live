@(username: String, twitterId: String)(implicit request: RequestHeader)

@import play.api.cache.Cache
@import play.api.Play.current
@import models.ChatRoom

    @getYouTubeId() = @{
        Cache.getOrElse[String]("youtubeid") {
            ""
        }
    }

    @getEpisodeNb() = @{
        Cache.getOrElse[String]("episodeNb") {
            ""
        }
    }

@main(Some(username)) {

    <div id="onError" class="alert-message error">
        <p>
            <strong>Oops!</strong> <span></span>
        </p>
    </div>

    <div class="row-fluid" style="background-image: url('@routes.Assets.at("images/bg-niptech.png")');">
        <div class="span1" style="height: 400px;"></div>
        <div class="span5" style="margin-left: 0px; border-left: 1px solid lightgray;">
            <div style="height: 45px; background-color: white">
                <span style="font-size: 18px; color: rgb(131,131,131); vertical-align: -20px; margin-left: 10px;">
                    Video board</span>
                <span style="float:right; font-size: 18px; margin-top:18px;margin-right:5px;)">niptech @getEpisodeNb()</span>
            </div>
            <div id="ytplayer" style="height: 350px;"></div>
            <div style="border-bottom: 1px solid lightgray; padding-bottom: 10px; background-color: white">
                <a class="nip-button" style="margin-left:10px; padding: 10px 10px;" id="reloadvideo" onclick="reloadVideo()">
                    Synchroniser avec le direct</a>
                <span name="twitterShare" id="twitterShare" class="pull-right" style="margin-right:20px; margin-top: 10px; font-family: Hero; color: rgb(131,131,131); font-size: 18px;">
                    Partager
                    <a href="https://twitter.com/intent/tweet?button_hashtag=nwlive&text=Rejoignez+nous+sur+la+chatroom+et+suivez+@@niptechpodcast+en+direct.&url=http://live.niptech.com" target="_blank" style="margin-left: 5px;">
                        <img src="@routes.Assets.at("images/twtr-nt.png")">
                    </a>
                    <a href="http://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flive.niptech.com&p[summary]=Rejoignez+nous+sur+la+chatroom+et+suivez+le+live+niptech+en+direct" target="_blank" style="margin-left: 5px;">
                        <img src="@routes.Assets.at("images/fb-nt.png")">
                    </a>
                    <a href="https://plus.google.com/share?url=http://live.niptech.com" target="_blank" style="margin-left: 5px;">
                        <img src="@routes.Assets.at("images/gplus-nt.png")">
                    </a>
                </span>
            </div>
            <div style="height:70px;background-color:white;border-bottom: 1px solid lightgray;"></div>
        </div>
        <div class="span4" style="margin-left: 0px; margin-right: 0px; border-left: 1px solid lightgray; width: 34%">
            <div style="height: 45px; background-color: white; border-bottom: 1px solid lightgray;">
                <span style="font-size: 18px; color: rgb(131,131,131); vertical-align: -20px; margin-left: 10px;">
                    Chat board</span>
            </div>
            <div id="onChat">
                <div id="main" style="height:100%;">
                    <div id="message-list" scroll-glue>
                        <div class="message" ng-repeat="msg in messages">
                            <img style="width:37px;height:28px;margin-left:-28px;margin-top:-5px;" src="@routes.Assets.at("images/bg-avatar.png")"><img style="display:inline-block;margin-top:-4px;margin-left:-35px;width:24px;height:24px;" src="{{msg.avatar}}">
                            <span>{{msg.user}}</span>
                            <em>{{msg.time}}</em>
                            <br/>
                            <p>{{msg.message}}</p>
                        </div>
                    </div>
                    <textarea id="talk" ng-model="currentMessage" ng-enter="sendMessage()"></textarea>
                </div>
            </div>
            <div class="alert alert-success fade in" id="infomsg" style="display: none">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <span></span>
            </div>
            <div class="alert alert-error fade in" id="errormsg" style="display: none">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <span></span>
            </div>
        </div>
        <div class="span2" style="margin-left: 0px; border-left: 1px solid lightgray; width:19.1%">
            <div style="height: 45px; background-color: white; border-bottom: 1px solid lightgray;">
                <span style="font-size: 18px; color: rgb(131,131,131); vertical-align: -20px; margin-left: 10px;">
                    En ligne : <span id="members-nbr" style="color:black;">@ChatRoom.members.length pers.</span>
                </span>
            </div>
            <div id="members-list">
                <div id="members" ng-repeat="user in users">
                    <span><img style="height:14px;margin-top:-3px;margin-left:-5px; padding-right:5px;" src="/assets/images/user.png">{{ user }}</span></br>
                </div>
            </div>
        </div>
    </div>

    <div id="changeuser" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="changeuserLabel" aria-hidden="true">
        <div style="background-image: url('@routes.Assets.at("images/bg-niptech.png")'); font-family: Hero">
            <div class="modal-header" style="text-align: center; font-size: 40px; line-height: 45px;">
                Connectez vous au live chat niptech !
            </div>
            <div class="modal-body">
                <p style="margin-left:80px; font-size:30px; color: rgb(131,131,131)">avec</p>
                <a href="@routes.Application.twitterLogin()">
                    <img style="margin-left: 200px;" src="@routes.Assets.at("images/twitter-home.png")">
                </a>
                <p style="margin-top:10px;color:rgb(131,131,131); font-size:10px;text-align:center;">
                    votre @@nom_utilisateur_twitter sera utilisé comme nickname
                </p>
                <p style="margin-top: 20px;font-size:30px;">ou saisissez votre nickname</p>
                <input type="input" name="username" id="username"
                style="margin-top: 5px;
                    width: 100%%;
                    height: 40px;
                    font-size: 23px;
                    font-family: " Trebuchet MS";
                    font-weight: bold;">
                <br/>
                <a class="nip-button" style="font-size: 30px; padding: 20px 0px; width: 100%" name="changeButton" id="changeButton">
                    Connexion</a>
            </div>
        </div>
    </div>

    </br>

    <footer style="text-align: center; font-size: 12px;">
        <a style="margin: 15px; text-decoration: underline;" href="http://www.niptech.com/podcast/niptech-podcast/" target="_blank">
            le podcast</a>
        <a style="margin: 15px; text-decoration: underline;" href="http://www.niptech.com/podcast/category/emissions/" target="_blank">
            les émissions</a>
        <a style="margin: 15px; text-decoration: underline;" href="http://www.niptech.com/podcast/category/blog/" target="_blank">
            le blog</a>
        <a style="margin: 15px; text-decoration: underline;" href="http://inspire.niptech.com/" target="_blank">
            les quotes</a>
        <a style="margin: 15px; text-decoration: underline;" href="https://plus.google.com/u/0/communities/104157063722839703523" target="_blank">
            la communauté</a>
        <a style="margin: 15px; text-decoration: underline;" href="https://github.com/Niptech/niptech-live" target="_blank">
            fork me on github</a>
    </footer>

    <script type="text/javascript" charset="utf-8">

        var tag = document.createElement('script');
        tag.src = "//www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        var player;
        function onYouTubeIframeAPIReady() {
        player = new YT.Player('ytplayer', {
        height: '100%',
        width: '100%',
        playerVars: { 'autoplay': 1, 'autohide': 1 },
        videoId: '@getYouTubeId()',
        events: {
        'onReady': onPlayerReady
        }
        });
        }

        function onPlayerReady(event) {
        // event.target.playVideo();
        }


        function reloadVideo() {
        player.loadVideoById("@getYouTubeId()")
        }

        function toggleHelp() {
        $("#help").popover('toggle')
        }

        function showMsg(textMsg) {
        $("#infomsg span").text(textMsg)
        var msg = $("#infomsg").alert()
        msg.fadeIn()
        msg.delay(3000).fadeOut()
        }

        function showErrorMsg(textMsg) {
        $("#errormsg span").text(textMsg)
        var msg = $("#errormsg").alert()
        msg.fadeIn()
        msg.delay(5000).fadeOut()
        }

        function changeNickname() {
        $('#changeuser').modal()
        $("#username").focus()
        }

        var allMembers = [];

    </script>


}
